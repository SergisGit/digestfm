!function(t,e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?module.exports=e(require("jquery")):t.jquery_dotdotdot_js=e(t.jQuery)}(this,function(t){return function(r){"use strict";function e(){s=r(window),o={},t={},i={},r.each([o,t,i],function(t,i){i.add=function(t){for(var e=0,n=(t=t.split(" ")).length;e<n;e++)i[t[e]]=i.ddd(t[e])}}),o.ddd=function(t){return"ddd-"+t},o.add("truncated keep text"),t.ddd=function(t){return"ddd-"+t},t.add("text"),i.ddd=function(t){return t+".ddd"},i.add("resize"),e=function(){}}var o,t,i,s,a="dotdotdot";r[a]&&"3.0.5"<r[a].version||(r[a]=function(t,e){this.$dot=t,this.api=["getInstance","truncate","restore","destroy","watch","unwatch"],this.opts=e;var n=this.$dot.data(a);return n&&n.destroy(),this.init(),this.truncate(),this.opts.watch&&this.watch(),this},r[a].version="3.0.5",r[a].uniqueId=0,r[a].defaults={ellipsis:"… ",truncate:"word",tolerance:0,keep:null,watch:"window"},r[a].prototype={init:function(){this.watchTimeout=null,this.watchInterval=null,this.uniqueId=r[a].uniqueId++,this.originalContent=this.$dot.contents(),this.originalStyle=this.$dot.attr("style")||"",this.maxHeight=this._getMaxHeight()+this.opts.tolerance,"break-word"!==this.$dot.css("word-wrap")&&this.$dot.css("word-wrap","break-word"),"nowrap"===this.$dot.css("white-space")&&this.$dot.css("white-space","normal")},getInstance:function(){return this},truncate:function(){var i=this;this.$inner=this.$dot.wrapInner("<div />").children().css({display:"block",height:"auto",width:"auto",border:"none",padding:0,margin:0}),this.$inner.contents().detach().end().append(this.originalContent.clone(!0)),this.$inner.find("script, style").addClass(o.keep),this.opts.keep&&this.$inner.find(this.opts.keep).addClass(o.keep),this.$inner.find("*").not("."+o.keep).add(this.$inner).contents().each(function(){var t=this,e=r(this);if(3==t.nodeType){if(e.prev().is("table, thead, tfoot, tr, th, td, dl, dt, dd, ul, ol, li, video"))return void e.remove();if(1<e.parent().contents().length){var n=r('<span class="'+o.text+'">'+i.__getTextContent(t)+"</span>").css({display:"inline",height:"auto",width:"auto",border:"none",padding:0,margin:0});e.replaceWith(n)}}else 8==t.nodeType&&e.remove()});var t=this._truncateNode(this.$dot);return this.$dot[t?"addClass":"removeClass"](o.truncated),this.$inner.find("."+o.text).each(function(){r(this).replaceWith(r(this).contents())}),this.$inner.find("."+o.keep).removeClass(o.keep),this.$inner.replaceWith(this.$inner.contents()),this.$inner=null,t},restore:function(){this.unwatch(),this.$dot.contents().detach().end().append(this.originalContent).attr("style",this.originalStyle).removeClass(o.truncated)},destroy:function(){this.restore(),this.$dot.data(a,null)},watch:function(){var e=this;this.unwatch();var n={};"window"==this.opts.watch?s.on(i.resize+e.uniqueId,function(t){e.watchTimeout&&clearTimeout(e.watchTimeout),e.watchTimeout=setTimeout(function(){n=e._watchSizes(n,s,"width","height")},100)}):this.watchInterval=setInterval(function(){n=e._watchSizes(n,e.$dot,"innerWidth","innerHeight")},500)},unwatch:function(){s.off(i.resize+this.uniqueId),this.watchInterval&&clearInterval(this.watchInterval),this.watchTimeout&&clearTimeout(this.watchTimeout)},_api:function(){var n=this,i={};return r.each(this.api,function(t){var e=this;i[e]=function(){var t=n[e].apply(n,arguments);return void 0===t?i:t}}),i},_truncateNode:function(t){var n=this,i=!1,s=!1;return r(t.children().get().reverse()).not("."+o.keep).each(function(){var t=(r(this).contents()[0],r(this));if(!i&&!t.hasClass(o.keep)){if(t.children().length)i=n._truncateNode(t);else if(!n._fits()||s){var e=r("<span>").css("display","none");if(t.replaceWith(e),t.detach(),n._fits()){if("node"==n.opts.truncate)return!0;e.replaceWith(t),(i=n._truncateWord(t))||(s=!0,t.detach())}else e.remove()}t.contents().length||t.remove()}}),i},_truncateWord:function(t){var e=t.contents()[0];if(!e)return!1;for(var n=this,i=this.__getTextContent(e),s=-1!==i.indexOf(" ")?" ":"　",r=i.split(s),o="",a=r.length;0<=a;a--){if(o=r.slice(0,a).join(s),0==a)return"letter"==n.opts.truncate&&(n.__setTextContent(e,r.slice(0,a+1).join(s)),n._truncateLetter(e));if(o.length&&(n.__setTextContent(e,n._addEllipsis(o)),n._fits()))return"letter"!=n.opts.truncate||(n.__setTextContent(e,r.slice(0,a+1).join(s)),n._truncateLetter(e))}return!1},_truncateLetter:function(t){for(var e=this,n=this.__getTextContent(t).split(""),i="",s=n.length;0<=s;s--)if((i=n.slice(0,s).join("")).length&&(e.__setTextContent(t,e._addEllipsis(i)),e._fits()))return!0;return!1},_fits:function(){return this.$inner.innerHeight()<=this.maxHeight},_addEllipsis:function(t){for(var e=[" ","　",",",";",".","!","?"];-1<r.inArray(t.slice(-1),e);)t=t.slice(0,-1);return t+this.opts.ellipsis},_getMaxHeight:function(){for(var t=["height","maxHeight"],e=0,n=0;n<t.length;n++){var i=window.getComputedStyle(this.$dot[0])[t[n]];"px"==i.slice(-2)&&(i=parseFloat(i),e=e?Math.min(e,i):i)}switch(this.$dot.css("boxSizing")){case"padding-box":case"border-box":for(t=["paddingTop","paddingBottom"],n=0;n<t.length;n++){var s=window.getComputedStyle(this.$dot[0])[t[n]];"px"==s.slice(-2)&&(e-=parseFloat(s))}}return Math.max(e,0)},_watchSizes:function(t,e,n,i){if(this.$dot.is(":visible")){var s={width:e[n](),height:e[i]()};return t.width==s.width&&t.height==s.height||this.truncate(),s}return t},__getTextContent:function(t){for(var e=["nodeValue","textContent","innerText"],n=0;n<e.length;n++)if("string"==typeof t[e[n]])return t[e[n]];return""},__setTextContent:function(t,e){for(var n=["nodeValue","textContent","innerText"],i=0;i<n.length;i++)t[n[i]]=e}},r.fn[a]=function(t){return e(),t=r.extend(!0,{},r[a].defaults,t),this.each(function(){r(this).data(a,new r[a](r(this),t)._api())})})}(t),!0});